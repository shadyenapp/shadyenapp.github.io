<html><head><meta content="text/html; charset=UTF-8" http-equiv="content-type"><style type="text/css">@import url(https://themes.googleusercontent.com/fonts/css?kit=1BVhQjsg_ddXeTZ1N5YwRA);ol{margin:0;padding:0}table td,table th{padding:0}.c34{border-right-style:solid;padding:0pt 5.4pt 0pt 5.4pt;border-bottom-color:#000000;border-top-width:1pt;border-right-width:1pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:1pt;border-top-style:solid;background-color:#dae9f7;border-left-style:solid;border-bottom-width:1pt;width:467.5pt;border-top-color:#000000;border-bottom-style:solid}.c7{border-right-style:solid;padding:0pt 5.4pt 0pt 5.4pt;border-bottom-color:#000000;border-top-width:1pt;border-right-width:1pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:1pt;border-top-style:solid;border-left-style:solid;border-bottom-width:1pt;width:116.8pt;border-top-color:#000000;border-bottom-style:solid}.c6{border-right-style:solid;padding:0pt 5.4pt 0pt 5.4pt;border-bottom-color:#000000;border-top-width:1pt;border-right-width:1pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:1pt;border-top-style:solid;border-left-style:solid;border-bottom-width:1pt;width:283.2pt;border-top-color:#000000;border-bottom-style:solid}.c24{border-right-style:solid;padding:0pt 5.4pt 0pt 5.4pt;border-bottom-color:#000000;border-top-width:1pt;border-right-width:1pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:1pt;border-top-style:solid;border-left-style:solid;border-bottom-width:1pt;width:88.1pt;border-top-color:#000000;border-bottom-style:solid}.c20{border-right-style:solid;padding:0pt 5.4pt 0pt 5.4pt;border-bottom-color:#000000;border-top-width:1pt;border-right-width:1pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:1pt;border-top-style:solid;border-left-style:solid;border-bottom-width:1pt;width:379.4pt;border-top-color:#000000;border-bottom-style:solid}.c23{border-right-style:solid;padding:0pt 5.8pt 0pt 5.8pt;border-bottom-color:#000000;border-top-width:1pt;border-right-width:0pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:1pt;border-top-style:solid;border-left-style:solid;border-bottom-width:1pt;width:161.2pt;border-top-color:#000000;border-bottom-style:solid}.c18{border-right-style:solid;padding:0pt 5.4pt 0pt 5.4pt;border-bottom-color:#000000;border-top-width:1pt;border-right-width:1pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:1pt;border-top-style:solid;border-left-style:solid;border-bottom-width:1pt;width:184.2pt;border-top-color:#000000;border-bottom-style:solid}.c28{border-right-style:solid;padding:0pt 5.4pt 0pt 5.4pt;border-bottom-color:#000000;border-top-width:1pt;border-right-width:1pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:1pt;border-top-style:solid;border-left-style:solid;border-bottom-width:1pt;width:256.6pt;border-top-color:#000000;border-bottom-style:solid}.c25{border-right-style:solid;padding:0pt 5.8pt 0pt 5.8pt;border-bottom-color:#000000;border-top-width:1pt;border-right-width:1pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:0pt;border-top-style:solid;border-left-style:solid;border-bottom-width:1pt;width:207.8pt;border-top-color:#000000;border-bottom-style:solid}.c12{border-right-style:solid;padding:0pt 5.8pt 0pt 5.8pt;border-bottom-color:#000000;border-top-width:1pt;border-right-width:1pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:1pt;border-top-style:solid;border-left-style:solid;border-bottom-width:1pt;width:99pt;border-top-color:#000000;border-bottom-style:solid}.c21{margin-left:28.4pt;padding-top:12pt;text-indent:-28.4pt;padding-bottom:12pt;line-height:1.1500000000000001;orphans:2;widows:2;text-align:left}.c27{margin-left:36pt;padding-top:0pt;padding-bottom:8pt;line-height:1.0;orphans:2;widows:2;text-align:left}.c14{color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:"Courier New";font-style:normal}.c15{color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:8pt;font-family:"Courier New";font-style:normal}.c1{color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:12pt;font-family:"Times New Roman";font-style:normal}.c29{padding-top:0pt;padding-bottom:0pt;line-height:1.0;orphans:2;widows:2;text-align:right}.c35{padding-top:0pt;padding-bottom:0pt;line-height:1.0;orphans:2;widows:2;text-align:left}.c31{padding-top:12pt;padding-bottom:12pt;line-height:1.1500000000000001;orphans:2;widows:2;text-align:left}.c0{padding-top:0pt;padding-bottom:0pt;line-height:1.1500000000000001;orphans:2;widows:2;text-align:left}.c4{padding-top:0pt;padding-bottom:8pt;line-height:1.1500000000000001;orphans:2;widows:2;text-align:left}.c2{font-size:12pt;font-family:"Times New Roman";color:#000000;font-weight:400;text-decoration:none}.c26{color:#000000;text-decoration:none;vertical-align:baseline;font-style:normal}.c9{-webkit-text-decoration-skip:none;color:#467886;text-decoration:underline;text-decoration-skip-ink:none}.c22{border-spacing:0;border-collapse:collapse;margin-right:auto}.c30{font-weight:400;font-size:11pt;font-family:"Aptos"}.c32{background-color:#ffffff;max-width:468pt;padding:72pt 72pt 72pt 72pt}.c3{font-size:12pt;font-family:"Times New Roman";font-weight:400}.c11{font-size:12pt;font-family:"Times New Roman";font-weight:700}.c13{color:inherit;text-decoration:inherit}.c17{margin-left:36pt;text-indent:-36pt}.c10{height:11pt}.c16{font-style:italic}.c19{text-indent:36pt}.c8{height:0pt}.c5{height:15pt}.c33{vertical-align:baseline}.c36{font-style:normal}.title{padding-top:0pt;color:#000000;font-size:28pt;padding-bottom:4pt;font-family:"Play";line-height:1.0;orphans:2;widows:2;text-align:left}.subtitle{padding-top:0pt;color:#595959;font-size:14pt;padding-bottom:8pt;font-family:"Aptos";line-height:1.0791666666666666;orphans:2;widows:2;text-align:left}li{color:#000000;font-size:11pt;font-family:"Aptos"}p{margin:0;color:#000000;font-size:11pt;font-family:"Aptos"}h1{padding-top:18pt;color:#0f4761;font-size:20pt;padding-bottom:4pt;font-family:"Play";line-height:1.0791666666666666;page-break-after:avoid;orphans:2;widows:2;text-align:left}h2{padding-top:8pt;color:#0f4761;font-size:16pt;padding-bottom:4pt;font-family:"Play";line-height:1.0791666666666666;page-break-after:avoid;orphans:2;widows:2;text-align:left}h3{padding-top:8pt;color:#0f4761;font-size:14pt;padding-bottom:4pt;font-family:"Aptos";line-height:1.0791666666666666;page-break-after:avoid;orphans:2;widows:2;text-align:left}h4{padding-top:4pt;color:#0f4761;font-size:11pt;padding-bottom:2pt;font-family:"Aptos";line-height:1.0791666666666666;page-break-after:avoid;font-style:italic;orphans:2;widows:2;text-align:left}h5{padding-top:4pt;color:#0f4761;font-size:11pt;padding-bottom:2pt;font-family:"Aptos";line-height:1.0791666666666666;page-break-after:avoid;orphans:2;widows:2;text-align:left}h6{padding-top:2pt;color:#595959;font-size:11pt;padding-bottom:0pt;font-family:"Aptos";line-height:1.0791666666666666;page-break-after:avoid;font-style:italic;orphans:2;widows:2;text-align:left}</style></head><body class="c32 doc-content"><p class="c4"><span class="c1">LokiBot Analysis</span></p><p class="c4"><span class="c1">Hayden Sapp and Hannah Ohm</span></p><p class="c4"><span class="c1">2024-04-22</span></p><p class="c4"><span class="c1">CI410: Malware Analysis Section 2</span></p><p class="c4"><span class="c26 c11">Background</span></p><p class="c4"><span class="c11">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c1">LokiBot was originally developed and released in 2015 by &ldquo;lokistov&rdquo;&mdash;a forum name for a hacker based in ex-USSR territories [1]. It is a trojan-based malware that masquerades as other software or uses software like Microsoft Word to execute itself. After installing itself without the user&rsquo;s knowledge, it will attempt to steal the user&rsquo;s passwords and login credentials from various sources like FTP applications, web browsers, stored WPA passkeys, and more. First seen in 2015, LokiBot continues to be a highly prevalent and ever-evolving malware. </span></p><p class="c4"><span class="c26 c11">History</span></p><p class="c4"><span class="c11">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c3">Originally released on forums in 2015, LokiBot was being sold for $800 as an any-purpose malware [1]. Since 2018, it&rsquo;s believed that lokistov was hacked and the source code to LokiBot was leaked due to independent sellers claiming they were selling LokiBot for as low as $80 [2]. As time went on more and more sources claimed to have LokiBot and they were selling slightly different variations on the original malware. From each iteration and addition to the original LokiBot, there are numerous new malware with new ways of infection still being classified as LokiBot. Using the original framework of the LokiBot malware attackers are able to tailor it to their specific needs, however it leaves them with the same signatures and Indicators of Compromise (IOC) that the original had. Since the leak of the original source code, different forks and variations of LokiBot have increased and spread with slight changes and alterations between the way it infects and what data it steals. Reports show that variations of LokiBot have been known to exploit CVE-2022-30190, CVE-2017-11882, CVE-2021-40444, and potentially more [6]. As each attacker adds their own spin and unique aspects to the malware, specifics of the LokiBot malware can be attributed differently over time. However, the one aspect unique to LokiBot that the majority of clones use is contacting a command-and-control server with a &ldquo;</span><span class="c3 c16">fre.php</span><span class="c1">&rdquo; file located on it. </span></p><p class="c4"><span class="c26 c11">Propagation Strategies</span></p><p class="c4"><span class="c11">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c1">The classic LokiBot was distributed by phishing schemes using Microsoft Excel documents that would trick the user into enabling macros by blurring the images within the Excel file. Once the user enabled macros, LokiBot would exploit CVE-2017-11882, a remote code execution which would install LokiBot in the background [3]. While some sources report that the macros being enabled is what allow the remote code execution, Microsoft officially states that just opening the infected Word/Excel document can infect the host computer [4]. </span></p><p class="c4"><span class="c1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;In altered versions of LokiBot, it will pose as an installation wizard and install the malicious software in the background, shown in figure 1. It&rsquo;s easy to notice the bad English and numerous command prompt windows that open during the installation of the &ldquo;Charted&rdquo; software that identify it as malicious. Unlike the classic LokiBot malware, this variation of the malware is spread through online sites that advertise fake software for people to download. </span></p><p class="c4"><span class="c1">Figure 1</span></p><p class="c4"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 552.25px; height: 313.24px;"><img alt="A computer screen with a message box

Description automatically generated" src="images/image3.png" style="width: 552.25px; height: 313.24px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c4"><span class="c3 c16">Note</span><span class="c1">. This figure shows the fictitious installation wizard that installs LokiBot. Obtained and analyzed from AnyRun [5]. </span></p><p class="c4"><span class="c11">Tactics</span></p><a id="t.ad3ae3ac1459c0344a0f8c535883a6992218a515"></a><a id="t.0"></a><table class="c22"><tr class="c8"><td class="c7" colspan="1" rowspan="1"><p class="c0"><span class="c1">Category</span></p></td><td class="c7" colspan="1" rowspan="1"><p class="c0"><span class="c1">Tactic</span></p></td><td class="c28" colspan="1" rowspan="1"><p class="c0"><span class="c1">Use</span></p></td></tr><tr class="c8"><td class="c7" colspan="1" rowspan="1"><p class="c0"><span class="c1">Execution</span></p></td><td class="c7" colspan="1" rowspan="1"><p class="c0"><span class="c1">T1059.001</span></p></td><td class="c28" colspan="1" rowspan="1"><p class="c0"><span class="c1">LokiBot is able to use PowerShell for command execution</span></p></td></tr><tr class="c8"><td class="c7" colspan="1" rowspan="1"><p class="c0"><span class="c1">Execution</span></p></td><td class="c7" colspan="1" rowspan="1"><p class="c0"><span class="c1">T1059.003</span></p></td><td class="c28" colspan="1" rowspan="1"><p class="c0"><span class="c1">LokiBot is able to use Windows CMD for command execution</span></p></td></tr><tr class="c8"><td class="c7" colspan="1" rowspan="1"><p class="c0"><span class="c1">Defense Evasion</span></p></td><td class="c7" colspan="1" rowspan="1"><p class="c0"><span class="c1">T1027.009</span></p></td><td class="c28" colspan="1" rowspan="1"><p class="c0"><span class="c1">LokiBot uses obfuscated and large files to hide embedded payloads</span></p></td></tr><tr class="c8"><td class="c7" colspan="1" rowspan="1"><p class="c0"><span class="c1">Defense Evasion</span></p></td><td class="c7" colspan="1" rowspan="1"><p class="c0"><span class="c1">T1564.003</span></p></td><td class="c28" colspan="1" rowspan="1"><p class="c0"><span class="c1">LokiBot will run PowerShell in hidden windows to hide the malicious commands</span></p></td></tr><tr class="c8"><td class="c7" colspan="1" rowspan="1"><p class="c0"><span class="c1">Discovery</span></p></td><td class="c7" colspan="1" rowspan="1"><p class="c0"><span class="c1">T1057</span></p></td><td class="c28" colspan="1" rowspan="1"><p class="c0"><span class="c1">LokiBot will use PowerShell to get information about processes</span></p></td></tr><tr class="c8"><td class="c7" colspan="1" rowspan="1"><p class="c0"><span class="c1">Discovery </span></p></td><td class="c7" colspan="1" rowspan="1"><p class="c0"><span class="c1">T1012</span></p></td><td class="c28" colspan="1" rowspan="1"><p class="c0"><span class="c1">LokiBot is able to read registry data, read security settings, identify server information, and the computer name</span></p></td></tr><tr class="c8"><td class="c7" colspan="1" rowspan="1"><p class="c0"><span class="c1">Discovery</span></p></td><td class="c7" colspan="1" rowspan="1"><p class="c0"><span class="c1">T1082</span></p></td><td class="c28" colspan="1" rowspan="1"><p class="c0"><span class="c1">LokiBot identifies the GUID for registry keys</span></p></td></tr><tr class="c8"><td class="c7" colspan="1" rowspan="1"><p class="c0"><span class="c1">Command and Control</span></p></td><td class="c7" colspan="1" rowspan="1"><p class="c0"><span class="c1">T1132</span></p></td><td class="c28" colspan="1" rowspan="1"><p class="c0"><span class="c1">LokiBot uses PowerShell to convert a large byte array to readable text to make traffic harder to detect. </span></p></td></tr></table><p class="c4 c10"><span class="c1"></span></p><p class="c4"><span class="c26 c11">Static Analysis Findings</span></p><p class="c4"><span class="c11">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c1">Using a static analysis tool like Virus Total show that this sample of malware goes by many different names and has a multitude of signatures&mdash;which makes sense given the mass small modifications made to the original LokiBot malware. This sample of LokiBot has been used with the following names:</span></p><a id="t.7097d53eeb078f7435bc3e76fcdd152138bf369b"></a><a id="t.1"></a><table class="c22"><tr class="c8"><td class="c18" colspan="1" rowspan="1"><p class="c0"><span class="c1">Name</span></p></td><td class="c6" colspan="1" rowspan="1"><p class="c0"><span class="c1">Security Vendor</span></p></td></tr><tr class="c8"><td class="c18" colspan="1" rowspan="1"><p class="c0"><span class="c1">LokiBot</span></p></td><td class="c6" colspan="1" rowspan="1"><p class="c0"><span class="c1">VBA32</span></p></td></tr><tr class="c8"><td class="c18" colspan="1" rowspan="1"><p class="c0"><span class="c1">Leonem</span></p></td><td class="c6" colspan="1" rowspan="1"><p class="c0"><span class="c1">AhnLab-V3</span></p></td></tr><tr class="c8"><td class="c18" colspan="1" rowspan="1"><p class="c0"><span class="c1">NSIS:TrojanX-gen</span></p></td><td class="c6" colspan="1" rowspan="1"><p class="c0"><span class="c1">Avast</span></p></td></tr><tr class="c8"><td class="c18" colspan="1" rowspan="1"><p class="c0"><span class="c1">Trojan.Dropper.NSIS</span></p></td><td class="c6" colspan="1" rowspan="1"><p class="c0"><span class="c1">Malwarebytes</span></p></td></tr><tr class="c8"><td class="c18" colspan="1" rowspan="1"><p class="c0"><span class="c1">Makoob</span></p></td><td class="c6" colspan="1" rowspan="1"><p class="c0"><span class="c1">Kingsoft</span></p></td></tr><tr class="c8"><td class="c18" colspan="1" rowspan="1"><p class="c0"><span class="c1">CLR!tr</span></p></td><td class="c6" colspan="1" rowspan="1"><p class="c0"><span class="c1">Fortinet</span></p></td></tr></table><p class="c4 c10"><span class="c1"></span></p><p class="c4"><span class="c1">The sample analyzed for this report has the following information:</span></p><a id="t.c7ed74148ac094657a57a9d449f478899bd3ba6f"></a><a id="t.2"></a><table class="c22"><tr class="c8"><td class="c24" colspan="1" rowspan="1"><p class="c0"><span class="c1">Name</span></p></td><td class="c20" colspan="1" rowspan="1"><p class="c0"><span class="c1">RFQ-SulselBarru_II_2-COAL_COMML_DOC.exe</span></p></td></tr><tr class="c8"><td class="c24" colspan="1" rowspan="1"><p class="c0"><span class="c1">Size (bytes)</span></p></td><td class="c20" colspan="1" rowspan="1"><p class="c0"><span class="c1">663136</span></p></td></tr><tr class="c8"><td class="c24" colspan="1" rowspan="1"><p class="c0"><span class="c1">md5 hash</span></p></td><td class="c20" colspan="1" rowspan="1"><p class="c0"><span class="c1">90fda5c072fe00e8e737606add7f1276</span></p></td></tr><tr class="c8"><td class="c24" colspan="1" rowspan="1"><p class="c0"><span class="c1">sha256 hash</span></p></td><td class="c20" colspan="1" rowspan="1"><p class="c0"><span class="c1">c384d26e83f585fbadd73e6cea441d1479d68de5bb647f775b506e5eab7f3230</span></p></td></tr><tr class="c8"><td class="c24" colspan="1" rowspan="1"><p class="c0"><span class="c1">Compilation time</span></p></td><td class="c20" colspan="1" rowspan="1"><p class="c0 c10"><span class="c1"></span></p><p class="c0"><span class="c1">2023-07-02 02:09:39 UTC</span></p></td></tr></table><p class="c4 c10"><span class="c1"></span></p><p class="c4"><span class="c1">The chart below shows the libraries and functions enumerated from the malware sample by VirusTotal.</span></p><a id="t.ccc69924f6231d85be7f91055428bdc89a044360"></a><a id="t.3"></a><table class="c22"><tr class="c5"><td class="c12" colspan="1" rowspan="1"><p class="c0"><span class="c1">ADVAPI32.dll </span></p><p class="c0"><span class="c1">&nbsp;</span></p></td><td class="c23" colspan="1" rowspan="1"><p class="c0"><span class="c1">AdjustTokenPrivileges </span></p><p class="c0"><span class="c1">LookupPrivilegeValueW </span></p><p class="c0"><span class="c1">OpenProcessToken </span></p><p class="c0"><span class="c1">RegCloseKey </span></p><p class="c0"><span class="c1">RegCreateKeyExW </span></p></td><td class="c25" colspan="1" rowspan="1"><p class="c0"><span class="c1">RegDeleteKeyW </span></p><p class="c0"><span class="c1">RegDeleteValueW </span></p><p class="c0"><span class="c1">RegEnumKeyW </span></p><p class="c0"><span class="c1">RegEnumValueW </span></p><p class="c0"><span class="c1">RegOpenKeyExW </span></p></td></tr><tr class="c5"><td class="c12" colspan="1" rowspan="1"><p class="c0"><span class="c1">SHELL32.dll </span></p><p class="c0"><span class="c1">&nbsp;</span></p></td><td class="c23" colspan="1" rowspan="1"><p class="c0"><span class="c1">SHBrowseForFolderW </span></p><p class="c0"><span class="c1">ShellExecuteExW </span></p><p class="c0"><span class="c1">SHFileOperationW </span></p></td><td class="c25" colspan="1" rowspan="1"><p class="c0"><span class="c1">SHGetFileInfoW </span></p><p class="c0"><span class="c1">SHGetPathFromIDListW </span></p><p class="c0"><span class="c1">&nbsp;</span></p></td></tr><tr class="c5"><td class="c12" colspan="1" rowspan="1"><p class="c0"><span class="c1">ole32.dll </span></p><p class="c0"><span class="c1">&nbsp;</span></p></td><td class="c23" colspan="1" rowspan="1"><p class="c0"><span class="c1">CoCreateInstance </span></p><p class="c0"><span class="c1">CoTaskMemFree </span></p><p class="c0"><span class="c1">IIDFromString </span></p></td><td class="c25" colspan="1" rowspan="1"><p class="c0"><span class="c1">OleInitialize </span></p><p class="c0"><span class="c1">OleUninitialize </span></p><p class="c0"><span class="c1">&nbsp;</span></p></td></tr><tr class="c5"><td class="c12" colspan="1" rowspan="1"><p class="c0"><span class="c1">COMCTL32.dll </span></p><p class="c0"><span class="c1">&nbsp;</span></p></td><td class="c23" colspan="1" rowspan="1"><p class="c0"><span class="c1">ImageList_AddMasked </span></p><p class="c0"><span class="c1">ImageList_Create </span></p></td><td class="c25" colspan="1" rowspan="1"><p class="c0"><span class="c1">ImageList_Destroy </span></p><p class="c0"><span class="c1">Ord(17) </span></p></td></tr><tr class="c5"><td class="c12" colspan="1" rowspan="1"><p class="c0"><span class="c1">USER32.dll </span></p><p class="c0"><span class="c1">&nbsp;</span></p></td><td class="c23" colspan="1" rowspan="1"><p class="c0"><span class="c1">AppendMenuW </span></p><p class="c0"><span class="c1">BeginPaint </span></p><p class="c0"><span class="c1">CallWindowProcW </span></p><p class="c0"><span class="c1">CharNextA </span></p><p class="c0"><span class="c1">CharNextW </span></p></td><td class="c25" colspan="1" rowspan="1"><p class="c0"><span class="c1">CharPrevW </span></p><p class="c0"><span class="c1">CheckDlgButton </span></p><p class="c0"><span class="c1">CloseClipboard </span></p><p class="c0"><span class="c1">CreateDialogParamW </span></p><p class="c0"><span class="c1">CreatePopupMenu </span></p></td></tr><tr class="c5"><td class="c12" colspan="1" rowspan="1"><p class="c0"><span class="c1">GDI32.dll </span></p><p class="c0"><span class="c1">&nbsp;</span></p></td><td class="c23" colspan="1" rowspan="1"><p class="c0"><span class="c1">CreateBrushIndirect </span></p><p class="c0"><span class="c1">CreateFontIndirectW </span></p><p class="c0"><span class="c1">DeleteObject </span></p><p class="c0"><span class="c1">GetDeviceCaps </span></p></td><td class="c25" colspan="1" rowspan="1"><p class="c0"><span class="c1">SelectObject </span></p><p class="c0"><span class="c1">SetBkColor </span></p><p class="c0"><span class="c1">SetBkMode </span></p><p class="c0"><span class="c1">SetTextColor </span></p></td></tr><tr class="c5"><td class="c12" colspan="1" rowspan="1"><p class="c0"><span class="c1">KERNEL32.dll </span></p><p class="c0"><span class="c1">&nbsp;</span></p></td><td class="c23" colspan="1" rowspan="1"><p class="c0"><span class="c1">CloseHandle </span></p><p class="c0"><span class="c1">CompareFileTime </span></p><p class="c0"><span class="c1">CopyFileW </span></p><p class="c0"><span class="c1">CreateDirectoryW </span></p><p class="c0"><span class="c1">CreateFileW </span></p></td><td class="c25" colspan="1" rowspan="1"><p class="c0"><span class="c1">CreateProcessW </span></p><p class="c0"><span class="c1">CreateThread </span></p><p class="c0"><span class="c1">DeleteFileW </span></p><p class="c0"><span class="c1">ExitProcess </span></p><p class="c0"><span class="c1">ExpandEnvironmentStringsW</span></p></td></tr></table><p class="c4 c10 c19"><span class="c1"></span></p><p class="c4 c19"><span class="c1">This sample of LokiBot imports SHELL32.dll, USERS32.dll, COMCTL32.dll, and KERNEL32.dll which contain standard functions for file deletion, file creation, window creation, command execution, and web connections. This sample poses as an installation wizard as it installs LokiBot in the background, which coincides with the imports seen in static analysis. It is also important to note that this variation of LokiBot was compiled, seen, and reported in late 2023, showing that LokiBot and its variations are still being created and exploited. </span></p><p class="c4"><span class="c3">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Additionally, this sample of LokiBot is a signed file with certificates signed by &ldquo;</span><span class="c3 c16">cradlefellow</span><span class="c1">&rdquo;. While appearing as a trusted and signed program at first glance, this certificate terminates at the root certificate authority which is an untrusted certificate. </span></p><p class="c4"><span class="c1">Figure 2</span></p><p class="c4"><span class="c3">&nbsp;&nbsp;</span><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 282.84px; height: 228.78px;"><img alt="A screenshot of a computer

Description automatically generated" src="images/image5.jpg" style="width: 282.84px; height: 228.78px; margin-left: -0.00px; margin-top: -0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 317.01px; height: 208.73px;"><img alt="A screenshot of a computer code

Description automatically generated" src="images/image4.jpg" style="width: 317.01px; height: 208.73px; margin-left: -0.00px; margin-top: -0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c4"><span class="c3 c16">Note</span><span class="c1">. This figure of IDA screenshots show the LokiBot sample changing privileges for access tokens, like the Shutdown Privilege. </span></p><p class="c4 c19"><span class="c1">The two images above in figure 2, show the assembly language of the compiled program. These show the program utilizing functions to change privileges for access tokens. Specifically, it is changing the privileges to shut down the system. In the left image, we see it accessing a temporary file &ldquo;~nsuXX.tmp&rdquo;, likely being used to store temporary changes to the token. In the Ghidra decompiler&mdash;shown in figure 3&mdash;there is evidence of tampering other token privileges, assigning it certain attributes.</span></p><p class="c4"><span class="c1">Figure 3</span></p><p class="c4 c19"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 624.00px; height: 46.87px;"><img alt="A close up of a number

Description automatically generated" src="images/image7.jpg" style="width: 624.00px; height: 46.87px; margin-left: -0.00px; margin-top: -0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c4"><span class="c3 c16">Note</span><span class="c1">. This figure of a Ghidra screenshot shows the imported Windows command &ldquo;AdjustTokenPrivileges&rdquo;. </span></p><p class="c4 c19"><span class="c3">When enumerating the strings for the program, there are a few files that the program touches, shown in figure 4. Likely this is enumerating information about the system, such as the version information, the language, and the internet settings, which can lead to more specific changes it can make to settings and permissions. &nbsp;</span></p><p class="c4"><span class="c1">Figure 4</span></p><p class="c4"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 624.00px; height: 97.13px;"><img alt="A close-up of a computer screen

Description automatically generated" src="images/image6.jpg" style="width: 624.00px; height: 97.13px; margin-left: -0.00px; margin-top: -0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c4"><span class="c3 c16">Note</span><span class="c1">. This figure shows the Strings search from Ghidra. </span></p><p class="c4"><span class="c26 c11">Dynamic Analysis Findings</span></p><p class="c4"><span class="c11">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c1">In the variation of LokiBot that poses as an installation wizard [5] it will run the following command in the background:</span></p><p class="c27"><span class="c14">&quot;powershell.exe&quot; -windowstyle hidden &quot;$Harish116=Get-Content &#39;C:\Users\admin\AppData\Local\Ubarberet\Graustark\resultalet\Unmeringued.Brd&#39;;$Omkldningsrums=$Harish116.SubString(61425,3);.$Omkldningsrums($Harish116)&quot;</span></p><p class="c4"><span class="c3">This command runs a hidden PowerShell window that gets the contents of the dropped file </span><span class="c3 c16">Unmeringued.Brd</span><span class="c3">&mdash;a file that has 61450 characters of ASCII text. This file is heavily obfuscated containing unreadable text, Danish words, Italian words, functions, and more. It then gets the substring of this text file from characters 61425 to 61427 and assigns it to a variable that then gets interpreted as a function. As shown in figure 5, the contents of this variable is the letters &ldquo;Iex&rdquo;, which is </span><span class="c3 c16">Invoke Expression</span><span class="c3">&nbsp;in PowerShell. Finally, the PowerShell window will attempt an </span><span class="c3 c16">Invoke Expression</span><span class="c3">&nbsp;on every function within the file. This file is likely the information transmitted between the host machine and the command-and-control server, given the identified Mitre tactic [T1132], where the above PowerShell command parses through a large data file for target Invoke-Expressions. As there are tens of thousands of characters in the file and this file is one of many files dropped during the execution of this malware, providing insightful analysis into this specific variation proves time consuming and difficult at the very </span><span class="c3 c16">least</span><span class="c1">. </span></p><p class="c4"><span class="c1">Figure 5</span></p><p class="c4"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 577.00px; height: 199.73px;"><img alt="" src="images/image2.png" style="width: 577.00px; height: 199.73px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 576.00px; height: 198.73px;"><img alt="" src="images/image1.png" style="width: 576.00px; height: 198.73px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c4"><span class="c3 c16">Note</span><span class="c3">. This figure shows the output of the &ldquo;</span><span class="c3 c16">Omkldningsrums</span><span class="c3">&rdquo;</span><span class="c3 c16">&nbsp;</span><span class="c1">function from the hidden PowerShell window that the installation window makes. </span></p><p class="c4"><span class="c3">One commonality on most LokiBot variants is the communication with a command-and-control server, specifically with the request to a &ldquo;</span><span class="c3 c16">fre.php</span><span class="c3">&rdquo; page. Leaked source code of the </span><span class="c3 c16">fre.php</span><span class="c1">&nbsp;page reveal that if the connection is not within its locally stored whitelist, it adds the IP address and connection information into an array of known infected machines [6]. </span></p><p class="c4"><span class="c26 c11">Current Threat Level</span></p><p class="c4 c19"><span class="c1">As there are more and more variations of this malware everyday, it is hard to pinpoint the exact abilities of it as of today. However, Lokibot was most recently seen in news articles in mid-2023. The articles indicated that this version of Lokibot acts as a keylogger, sending crafted HTTP packets containing keystrokes. The news also indicates that it is more often found in phishing emails now, rather than impersonating software downloads. [13]</span></p><p class="c4"><span class="c11 c26">Mitigation Strategies</span></p><p class="c4"><span class="c11">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c1">The Cybersecurity and Infrastructure Security Agency (CISA) developed a snort rule to detect and block any standard LokiBot activity and create an alert of the activity, as shown below [7]. </span></p><p class="c4"><span class="c1">Figure 3</span></p><a id="t.e65790035e198270dd133f37908d6d30cafe0ab9"></a><a id="t.4"></a><table class="c22"><tr class="c8"><td class="c34" colspan="1" rowspan="1"><p class="c35"><span class="c15">alert tcp any any -&gt; any $HTTP_PORTS (msg:&quot;Lokibot:HTTP URI POST contains &#39;/*/fre.php&#39; post-infection&quot;; flow:established,to_server; flowbits:isnotset,.tagged; content:&quot;/fre.php&quot;; http_uri; fast_pattern:only; urilen:&lt;50,norm; content:&quot;POST&quot;; nocase; http_method; pcre:&quot;/\/(?:alien|loky\d|donep|jemp|lokey|new2|loki|Charles|sev7n|dbwork|scroll\/NW|wrk|job|five\d?|donemy|animation\dkc|love|Masky|v\d|lifetn|Ben)\/fre\.php$/iU&quot;; flowbits:set,.tagged;classtype:http-uri; metadata:service http; metadata:pattern HTTP-P001,)</span></p></td></tr></table><p class="c4"><span class="c3 c16">Note</span><span class="c1">. This figure is a SNORT firewall rule that can detect LokiBot activity on a network and report it as such. Developed by CISA, received from [7]. </span></p><p class="c4"><span class="c3">While this snort rule won&rsquo;t prevent or uninstall the LokiBot software from the machine, it alerts for any requests to any </span><span class="c3 c16">fre.php </span><span class="c1">on any website. CISA also recommends maintaining up-to-date antivirus signatures as LokiBot is an ever-evolving malware. Additionally, the ability to install and run software should be limited to only administrators to prevent the trojan horse style of LokiBot from having access to the system. Additionally, the National Institute of Standards and Technology recommends adhering to the 800-83 specifications standard which outlines malware incident response and prevention [9]. </span></p><p class="c4 c10"><span class="c1"></span></p><p class="c4 c10"><span class="c1"></span></p><p class="c4 c10"><span class="c1"></span></p><p class="c4 c10"><span class="c1"></span></p><p class="c4 c10"><span class="c1"></span></p><p class="c4 c10"><span class="c1"></span></p><p class="c4 c10"><span class="c1"></span></p><p class="c4 c10"><span class="c1"></span></p><p class="c4 c10"><span class="c1"></span></p><p class="c4 c10"><span class="c1"></span></p><p class="c4"><span class="c11">References</span></p><p class="c4 c17"><span class="c3">[1] AnyRun, LLC. (2024). &ldquo;</span><span class="c3 c16">Malware Trends: LokiBot&rdquo;</span><span class="c3">. AnyRun.com. </span><span class="c9 c3"><a class="c13" href="https://www.google.com/url?q=https://any.run/malware-trends/lokibot&amp;sa=D&amp;source=editors&amp;ust=1719340390787778&amp;usg=AOvVaw15He5Pp8rFqUfW7jXjW5h_">https://any.run/malware-trends/lokibot</a></span><span class="c9 c3">&nbsp;</span><span class="c2">(Accessed April 22, 2024)</span></p><p class="c4 c17"><span class="c3">[2] Schwartz, M. (2023, September 14). &ldquo;</span><span class="c3 c16">LokiBot Information Stealer Packs Fresh Infection Strategies&rdquo;.</span><span class="c3">&nbsp;BankInfoSecurity.com. </span><span class="c9 c3"><a class="c13" href="https://www.google.com/url?q=https://www.bankinfosecurity.com/lokibot-information-stealer-packs-fresh-infection-strategies-a-23079&amp;sa=D&amp;source=editors&amp;ust=1719340390788726&amp;usg=AOvVaw2-vnpk02ykNyaDXLTtft-L">https://www.bankinfosecurity.com/lokibot-information-stealer-packs-fresh-infection-strategies-a-23079</a></span><span class="c9 c3">&nbsp;</span><span class="c1">(Accessed April 22, 2024)</span></p><p class="c4 c17"><span class="c3">[3] Sison, G &amp; Co, M. (2018, February 8). &ldquo;</span><span class="c3 c16">Attack Using Windows Installer Leads to LokiBot&rdquo;. </span><span class="c3">TrendMicro.com. </span><span class="c9 c3"><a class="c13" href="https://www.google.com/url?q=https://www.trendmicro.com/en_us/research/18/b/attack-using-windows-installer-msiexec-exe-leads-lokibot.html&amp;sa=D&amp;source=editors&amp;ust=1719340390789581&amp;usg=AOvVaw3RFv1_IvVXS-guiyNrhNUP">https://www.trendmicro.com/en_us/research/18/b/attack-using-windows-installer-msiexec-exe-leads-lokibot.html</a></span><span class="c3 c9">&nbsp;</span><span class="c2">(Accessed April 22, 2024)</span></p><p class="c4 c17"><span class="c3">[4] Microsoft Corporation. (2017, November 29). &ldquo;</span><span class="c3 c16">Microsoft Office Memory Corruption Vulnerability&rdquo;.</span><span class="c3">&nbsp;Microsoft.com. </span><span class="c9 c3"><a class="c13" href="https://www.google.com/url?q=https://msrc.microsoft.com/update-guide/en-US/advisory/CVE-2017-11882&amp;sa=D&amp;source=editors&amp;ust=1719340390790455&amp;usg=AOvVaw0wIdrBLBfyD3hxmtdCwXU8">https://msrc.microsoft.com/update-guide/en-US/advisory/CVE-2017-11882</a></span><span class="c9 c3">&nbsp;</span><span class="c2">(Accessed April 22, 2024)</span></p><p class="c4 c17"><span class="c3">[5] AnyRun, LLC. (2024). &ldquo;</span><span class="c3 c16">LokiBot Malware Task</span><span class="c3">&rdquo;. Any.Run </span><span class="c9 c3"><a class="c13" href="https://www.google.com/url?q=https://app.any.run/tasks/af4c4ddf-e1d4-4cf3-b0e1-64472eaf33ce/&amp;sa=D&amp;source=editors&amp;ust=1719340390791272&amp;usg=AOvVaw1nRA0z03wIBQzc4q_7OUVr">https://app.any.run/tasks/af4c4ddf-e1d4-4cf3-b0e1-64472eaf33ce/</a></span><span class="c9 c3">&nbsp;</span><span class="c2">(Accessed April 22, 2024)</span></p><p class="c4 c17"><span class="c3">[6] NexusFuzzy. (2019, June 12). &ldquo;</span><span class="c3 c16">Leaked LokiBot Panel&rdquo;. </span><span class="c3">GitHub.com. </span><span class="c9 c3"><a class="c13" href="https://www.google.com/url?q=https://github.com/NexusFuzzy/lokibot/blob/master/fre.php&amp;sa=D&amp;source=editors&amp;ust=1719340390792026&amp;usg=AOvVaw273VM4kPY1APkFXcOEQlkW">https://github.com/NexusFuzzy/lokibot/blob/master/fre.php</a></span><span class="c9 c3">&nbsp;</span><span class="c2">(Accessed April 21, 2024)</span></p><p class="c4 c17"><span class="c3">[7] CISA. (2020, October 24). &ldquo;</span><span class="c3 c16">LokiBot Malware Cybersecurity Advisory&rdquo;</span><span class="c3">. CISA.gov. </span><span class="c9 c3"><a class="c13" href="https://www.google.com/url?q=https://www.cisa.gov/news-events/cybersecurity-advisories/aa20-266a&amp;sa=D&amp;source=editors&amp;ust=1719340390792816&amp;usg=AOvVaw0HJkHwJjJRfav7TfEQvgh7">https://www.cisa.gov/news-events/cybersecurity-advisories/aa20-266a</a></span><span class="c2">(Accessed April 22, 2024)</span></p><p class="c4 c17"><span class="c3">[8] VirusTotal. (2024). &ldquo;</span><span class="c3 c16">Static Analysis Report for c384d26e83f585fbadd73e6cea441d1479d68de5bb647f775b506e5eab7f3230&rdquo;. </span><span class="c3">VirusTotal.com.</span><span class="c3 c16">&nbsp;</span><span class="c9 c3"><a class="c13" href="https://www.google.com/url?q=https://www.virustotal.com/gui/file/c384d26e83f585fbadd73e6cea441d1479d68de5bb647f775b506e5eab7f3230&amp;sa=D&amp;source=editors&amp;ust=1719340390793641&amp;usg=AOvVaw06uDaVMIkpin6VLSmJHdc4">https://www.virustotal.com/gui/file/c384d26e83f585fbadd73e6cea441d1479d68de5bb647f775b506e5eab7f3230</a></span><span class="c9 c3">&nbsp;</span><span class="c2">(Accessed April 22, 2024)</span></p><p class="c4 c17"><span class="c2">[9] NIST. (2013, July). &ldquo;</span><span class="c2 c16">Guide to Malware Incident Prevention and Handling for Desktops and Laptops&rdquo;</span><span class="c2">. NIST.gov. (Accessed April 22, 2024). [Online]. Available: </span><span class="c9 c3"><a class="c13" href="https://www.google.com/url?q=https://csrc.nist.gov/pubs/sp/800/83/r1/final&amp;sa=D&amp;source=editors&amp;ust=1719340390794426&amp;usg=AOvVaw0w6HSXOmO5u5z16eN8Sft8">https://csrc.nist.gov/pubs/sp/800/83/r1/final</a></span><span class="c2">, </span><span class="c9 c3"><a class="c13" href="https://www.google.com/url?q=https://doi.org/10.6028/NIST.SP.800-83r1&amp;sa=D&amp;source=editors&amp;ust=1719340390794801&amp;usg=AOvVaw3_sZr0uUZMrqI52fA0HZic">https://doi.org/10.6028/NIST.SP.800-83r1</a></span><span class="c1">.</span></p><p class="c17 c31"><span class="c3">[10] &ldquo;Lokibot,&rdquo; Lokibot, Software S0447 | MITRE ATT&amp;CK&reg;, </span><span class="c9 c3"><a class="c13" href="https://www.google.com/url?q=https://attack.mitre.org/software/S0447/&amp;sa=D&amp;source=editors&amp;ust=1719340390795315&amp;usg=AOvVaw2ZHtXtO3bfzYxjBqTjrwj1">https://attack.mitre.org/software/S0447/</a></span><span class="c1">. </span></p><p class="c21"><span class="c3">[11] M. Corporation, &ldquo;Microsoft,&rdquo; threat description - Microsoft Security Intelligence, </span><span class="c9 c3"><a class="c13" href="https://www.google.com/url?q=https://www.microsoft.com/en-us/wdsi/threats/malware-encyclopedia-description?Name%3DTrojan%253AWin32%252FLokibot.PB%26ThreatID%3D2147831711&amp;sa=D&amp;source=editors&amp;ust=1719340390795968&amp;usg=AOvVaw0sby9f35m4Bdaz9IVE_nAk">https://www.microsoft.com/en-us/wdsi/threats/malware-encyclopedia-description?Name=Trojan%3AWin32%2FLokibot.PB&amp;ThreatID=2147831711</a></span><span class="c1">&nbsp;(accessed Apr. 23, 2024). </span></p><p class="c21"><span class="c3">[12] &ldquo;202309291200_LokiBot malware analyst note_tlpclear,&rdquo; Health Sector Cybersecurity Coordination Center, </span><span class="c9 c3"><a class="c13" href="https://www.google.com/url?q=https://www.hhs.gov/sites/default/files/lokibot-malware-analyst-note-tlpclear.pdf&amp;sa=D&amp;source=editors&amp;ust=1719340390796579&amp;usg=AOvVaw108WRUZbLlkLGfUFK2F6eo">https://www.hhs.gov/sites/default/files/lokibot-malware-analyst-note-tlpclear.pdf</a></span><span class="c1">&nbsp;(accessed Apr. 23, 2024). </span></p><p class="c21"><span class="c1">[13] E. Naprys, &ldquo;LokiBot malware going for a song at $80,&rdquo; CyberNews, https://cybernews.com/security/lokibot-malware-going-for-a-song-at-80 (accessed Apr. 25, 2024).</span></p><p class="c21"><span class="c3">[14] &ldquo;Cybercriminals exploit Microsoft word vulnerabilities to deploy LokiBot malware,&rdquo; The Hacker News, </span><span class="c9 c3"><a class="c13" href="https://www.google.com/url?q=https://thehackernews.com/2023/07/cybercriminals-exploit-microsoft-word.html&amp;sa=D&amp;source=editors&amp;ust=1719340390797336&amp;usg=AOvVaw2DgAqX05ip740xlZsyhlXw">https://thehackernews.com/2023/07/cybercriminals-exploit-microsoft-word.html</a></span><span class="c1">&nbsp;(accessed Apr. 24, 2024).</span></p><p class="c4 c10"><span class="c1"></span></p><div><p class="c10 c29"><span class="c26 c30"></span></p><p class="c35 c10"><span class="c26 c30"></span></p></div></body></html>